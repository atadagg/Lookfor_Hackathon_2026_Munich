#!/usr/bin/env python3
"""Quick smoke test for storage module."""
from core.storage import upload_attachment, get_attachment_stream

# 1x1 PNG
DATA = bytes([
    0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A,
    0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52,
    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
    0x08, 0x02, 0x00, 0x00, 0x00, 0x90, 0x77, 0x53,
    0xDE, 0x00, 0x00, 0x00, 0x0C, 0x49, 0x44, 0x41,
    0x54, 0x78, 0x9C, 0x63, 0xF8, 0x0F, 0xC0, 0x00,
    0x00, 0x01, 0x00, 0x01, 0x00, 0x0F, 0xA4, 0xB8,
    0xF4, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4E,
    0x44, 0xAE, 0x42, 0x60, 0x82
])
meta = upload_attachment("test-conv", DATA, "image/png", "test.png")
print("Upload:", meta)
assert meta, "upload should return metadata"
stream = get_attachment_stream(meta["object_key"])
assert stream is not None, "get_attachment_stream should return data"
assert len(stream[0]) == len(DATA), "retrieved data should match uploaded"
print("Storage OK")
